<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="bower_components/bootstrap/dist/css/bootstrap.min.css"
	rel="stylesheet">
<link href="bower_components/metisMenu/dist/metisMenu.min.css"
	rel="stylesheet">
<link href="dist/css/sb-admin-2.css" rel="stylesheet">
<link href="bower_components/font-awesome/css/font-awesome.min.css"
	rel="stylesheet" type="text/css">
<link rel="stylesheet" type="text/css" href="font/flaticon.css">
<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->
<title>VORTO Web Modeler</title>
<link rel="stylesheet" type="text/css" href="jointjs/joint.min.css">
<link rel="stylesheet" type="text/css" href="jointjs/jquery-ui.min.css">
<script src="bower_components/jquery/dist/jquery.min.js"></script>
<script type="text/javascript" src="jointjs/lodash.min.js"></script>
<script type="text/javascript" src="jointjs/backbone-min.js"></script>
<script type="text/javascript" src="jointjs/joint.min.js"></script>
<script type="text/javascript" src="jointjs/jquery-ui.min.js"></script>
<script type="text/javascript" src="data/devices.js"></script>
<script type="text/javascript">
        function allowDrop(ev) {
            ev.preventDefault();
        }

        function dragleave(ev) {
            console.log(ev.target.id);
            var m3 = m1.clone();
        	m3.translate(500, 0);
        	graph.addCell(m3);
        	/* var json = graph.toJSON()
        	console.log(json); */
        }

       
        </script>
<style type="text/css">
#paper {
	position: relative;
	overflow: hidden;
}
.html-element {
	position: absolute;
	background: #3498DB;
	/* Make sure events are propagated to the JointJS element so, e.g. dragging works.*/
	pointer-events: none;
	-webkit-user-select: none;
	border-radius: 4px;
	border: 2px solid #2980B9;
	box-shadow: inset 0 0 5px black, 2px 2px 1px gray;
	padding: 5px;
	box-sizing: border-box;
	z-index: 2;
}
.html-element select,.html-element input,.html-element button {
	/* Enable interacting with inputs only. */
	pointer-events: auto;
}
.html-element button.delete {
	color: white;
	border: none;
	background-color: #C0392B;
	border-radius: 20px;
	width: 15px;
	height: 15px;
	line-height: 15px;
	text-align: middle;
	position: absolute;
	top: -15px;
	left: -15px;
	padding: 0;
	margin: 0;
	font-weight: bold;
	cursor: pointer;
}

.html-element button.delete:hover {
	width: 20px;
	height: 20px;
	line-height: 20px;
}

.html-element select {
	position: absolute;
	right: 2px;
	bottom: 28px;
}

.html-element label {
	color: #333;
	text-shadow: 1px 0 0 lightgray;
	font-weight: bold;
}

.html-element span {
	position: absolute;
	top: 2px;
	right: 9px;
	color: white;
	font-size: 10px;
}
</style>


</head>
<body>
	<div id="wrapper">
		<!-- Navigation -->
		<nav class="navbar navbar-default navbar-static-top" role="navigation"
			style="margin-bottom: 0">
			<div class="navbar-header">
				<button type="button" class="navbar-toggle" data-toggle="collapse"
					data-target=".navbar-collapse">
					<span class="sr-only">Toggle navigation</span> <span
						class="icon-bar"></span> <span class="icon-bar"></span> <span
						class="icon-bar"></span>
				</button>
				<a class="navbar-brand" href="index.html">VORTO Web Modeler</a>
			</div>
			<ul class="nav navbar-top-links navbar-right">
				<li class="dropdown"><a class="dropdown-toggle"
					data-toggle="dropdown" href="#"> <i class="fa fa-bell fa-fw"></i>
						<i class="fa fa-caret-down"></i>
				</a>
					<ul class="dropdown-menu dropdown-alerts">
						<li><a href="#">
								<div>
									<i class="fa fa-comment fa-fw"></i> Notification <span
										class="pull-right text-muted small">4 minutes ago</span>
								</div>
						</a></li>
						<li class="divider"></li>
						<li><a href="#">
								<div>
									<i class="fa fa-envelope fa-fw"></i> Alert 01 <span
										class="pull-right text-muted small">12 minutes ago</span>
								</div>
						</a></li>
						<li class="divider"></li>
						<li><a href="#">
								<div>
									<i class="fa fa-envelope fa-fw"></i> Alert 02 <span
										class="pull-right text-muted small">13 minutes ago</span>
								</div>
						</a></li>
						<li class="divider"></li>
						<li><a class="text-center" href="#"> <strong>See
									All Notifications</strong> <i class="fa fa-angle-right"></i>
						</a></li>
					</ul> <!-- /.dropdown-alerts --></li>
				<!-- /.dropdown -->
				<li class="dropdown"><a class="dropdown-toggle"
					data-toggle="dropdown" href="#"> <i class="fa fa-user fa-fw"></i>
						<i class="fa fa-caret-down"></i>
				</a>
					<ul class="dropdown-menu dropdown-user">
						<li><a href="#"><i class="fa fa-user fa-fw"></i> User
								Profile</a></li>
						<li><a href="#"><i class="fa fa-gear fa-fw"></i> Settings</a>
						</li>
						<li class="divider"></li>
						<li><a href="login.html"><i class="fa fa-sign-out fa-fw"></i>
								Login</a></li>
					</ul> <!-- /.dropdown-user --></li>
				<!-- /.dropdown -->
			</ul>
			<!-- /.navbar-top-links -->

			<div class="navbar-default sidebar" role="navigation">
				<div class="sidebar-nav navbar-collapse">
					<ul class="nav" id="side-menu">
						<li class="sidebar-search">
							<div class="input-group custom-search-form">
								<input type="text" class="form-control" placeholder="Search...">
								<span class="input-group-btn">
									<button class="btn btn-default" type="button">
										<i class="fa fa-search"></i>
									</button>
								</span>
							</div> <!-- /input-group -->
						</li>
						<li><a href="index.html"><i
								class="glyphicon glyphicon-th-large"></i> IOT Devices </a></li>
						<li><a href="#"><i class="glyphicon glyphicon-hdd"></i>
								Device Category 1 <span class="fa arrow"></span></a>
							<ul class="nav nav-second-level">
								<table class='table table-bordered'>
									<tbody>
										<tr>
											<td><i id="ss" class="glyph-icon flaticon-cable"
												draggable="true" ondragleave="dragleave(event)"></i></td>
											<td><i class="glyph-icon flaticon-charger"
												draggable="true" ondragstart="drag(event)"></i></td>
											<td><i class="glyph-icon flaticon-charger-1"
												draggable="true" ondragstart="drag(event)"></i></td>
										</tr>
										<tr>
											<td><i class="glyph-icon flaticon-chip" draggable="true"></i></td>
											<td><i class="glyph-icon flaticon-chip-1"
												draggable="true"></i></td>
											<td><i class="glyph-icon flaticon-charger-2"
												draggable="true"></i></td>
										</tr>
										<tr>
											<td><i class="glyph-icon flaticon-computer"
												draggable="true"></i></td>
											<td><i class="glyph-icon flaticon-cooler"
												draggable="true"></i></td>
											<td><i class="glyph-icon flaticon-copy-machine"
												draggable="true"></i></td>
										</tr>
										<tr>
											<td><i class="glyph-icon flaticon-earphones"
												draggable="true"></i></td>
											<td><i class="glyph-icon flaticon-ethernet"
												draggable="true"></i></td>
											<td><i class="glyph-icon flaticon-game-console"
												draggable="true"></i></td>
										</tr>
										<tr>
											<td><i class="glyph-icon flaticon-game-console-1"
												draggable="true"></i></td>
											<td><i class="glyph-icon flaticon-game-controller-1"
												draggable="true"></i></td>
											<td><i class="glyph-icon flaticon-hdmi" draggable="true"></i></td>
										</tr>
									</tbody>
								</table>
							</ul></li>
					</ul>
				</div>
				<!-- /.sidebar-collapse -->
			</div>
			<!-- /.navbar-static-side -->
		</nav>

		<div id="page-wrapper">

			<!-- /.row -->
			<div class="row">
				<br></br>
			</div>
			<div class="row">
				<div class="col-lg-12">
					<div class="panel panel-default">
						<div class="panel-heading">
							<i class="glyphicon glyphicon-th-large"></i> Visual Modeling
							Dashboard
							<div class="pull-right">
								<div class="btn-group">
									<button type="button"
										class="btn btn-default btn-xs dropdown-toggle"
										data-toggle="dropdown">
										Actions <span class="caret"></span>
									</button>
									<ul class="dropdown-menu pull-right" role="menu">
										<li><a href="#">Reset</a></li>
										<li><a href="#">Export</a></li>
										<li><a href="#">Import</a></li>
										<li class="divider"></li>
										<li><a href="#">Save As</a></li>
									</ul>
								</div>
							</div>
						</div>
						<div class="panel-body">
							<div id="paper"></div>
						</div>
					</div>
				</div>

			</div>
			<!-- /.row -->
		</div>
		<!-- /#page-wrapper -->

	</div>
	<script type="text/javascript">

	 var graph = new joint.dia.Graph;

	    var paper = new joint.dia.Paper({
	        el: $('#paper'),
	        width: 1500,
	        height: 700,
	        model: graph
	    });

	    // Create a custom element.
	    // ------------------------
	    joint.shapes.html = {};
	    joint.shapes.html.Element = joint.shapes.basic.Generic.extend(_.extend({}, joint.shapes.basic.PortsModelInterface, {
	        markup: '<g class="rotatable"><g class="scalable"><rect/></g><g class="inPorts"/><g class="outPorts"/></g>',
	        portMarkup: '<g class="port<%= id %>"><circle/></g>',
	        defaults: joint.util.deepSupplement({
	            type: 'html.Element',
	            size: { width: 100, height: 80 },
	            inPorts: [],
	            outPorts: [],
	            attrs: {
	                '.': { magnet: false },
	                rect: {
	                    stroke: 'none', 'fill-opacity': 0, width: 150, height: 250,
	                },
	                circle: {
	                    r: 6, //circle radius
	                    magnet: true,
	                    stroke: 'black'
	                },

	                '.inPorts circle': { fill: 'green', magnet: 'passive', type: 'input'},
	                '.outPorts circle': { fill: 'red', type: 'output'}
	            }
	        }, joint.shapes.basic.Generic.prototype.defaults),
	        getPortAttrs: function (portName, index, total, selector, type) {

	            var attrs = {};
	            var portClass = 'port' + index;
	            var portSelector = selector + '>.' + portClass;
	            var portCircleSelector = portSelector + '>circle';
	            attrs[portCircleSelector] = { port: { id: portName || _.uniqueId(type), type: type } };
	            attrs[portSelector] = { ref: 'rect', 'ref-y': (index + 0.5) * (1 / total) };
	            if (selector === '.outPorts') { attrs[portSelector]['ref-dx'] = 0; }
	            return attrs;
	        }
	    }));


	   // Create a custom view for that element that displays an HTML div above it.
	   // -------------------------------------------------------------------------

	    joint.shapes.html.ElementView = joint.dia.ElementView.extend({

	        template: [
	            '<div class="html-element">',
	            '<button class="delete">x</button>',
	            '<span id="lbl" value="Please write here"></span>',
	            '</div>'
	        ].join(''),

	    initialize: function() {
	        _.bindAll(this, 'updateBox');
	        joint.dia.ElementView.prototype.initialize.apply(this, arguments);

	        this.$box = $(_.template(this.template)());
	        // Prevent paper from handling pointerdown.
	        this.$box.find('input,select').on('mousedown click', function(evt) { evt.stopPropagation(); });


	        // This is an example of reacting on the input change and storing the input data in the cell model.
	        
	        this.$box.find('.delete').on('click', _.bind(this.model.remove, this.model));
	        // Update the box position whenever the underlying model changes.
	        this.model.on('change', this.updateBox, this);
	        // Remove the box when the model gets removed from the graph.
	        this.model.on('remove', this.removeBox, this);

	        this.updateBox();

	        this.listenTo(this.model, 'process:ports', this.update);
	        joint.dia.ElementView.prototype.initialize.apply(this, arguments);
	    },


	     render: function() {
	        joint.dia.ElementView.prototype.render.apply(this, arguments);
	        this.paper.$el.prepend(this.$box);
	        // this.paper.$el.mousemove(this.onMouseMove.bind(this)), this.paper.$el.mouseup(this.onMouseUp.bind(this));
	        this.updateBox();
	        return this;
	    },

	    renderPorts: function () {
	        var $inPorts = this.$('.inPorts').empty();
	        var $outPorts = this.$('.outPorts').empty();

	        var portTemplate = _.template(this.model.portMarkup);

	        _.each(_.filter(this.model.ports, function (p) { return p.type === 'in' }), function (port, index) {

	            $inPorts.append(V(portTemplate({ id: index, port: port })).node);
	        });
	        _.each(_.filter(this.model.ports, function (p) { return p.type === 'out' }), function (port, index) {

	            $outPorts.append(V(portTemplate({ id: index, port: port })).node);
	        });
	    }, 

	    update: function () {

	        // First render ports so that `attrs` can be applied to those newly created DOM elements
	        // in `ElementView.prototype.update()`.
	        this.renderPorts();
	        joint.dia.ElementView.prototype.update.apply(this, arguments);
	    },

	    updateBox: function() {
	        // Set the position and dimension of the box so that it covers the JointJS element.
	        var bbox = this.model.getBBox();
	        // Example of updating the HTML with a data stored in the cell model.
	        // paper.on('blank:pointerdown', function(evt, x, y) { this.$box.find('textarea').toBack(); });
	        this.$box.find('span').text(this.model.get('textarea'));
	        this.model.on('cell:pointerclick', function(evt, x, y) { this.$box.find('textarea').toFront(); });
	        this.$box.css({ width: bbox.width, height: bbox.height, left: bbox.x, top: bbox.y, transform: 'rotate(' + (this.model.get('angle') || 0) + 'deg)' });
	    },
	    removeBox: function(evt) {
	        this.$box.remove();
	    }
	}); 


	// Create JointJS elements and add them to the graph as usual.
	// -----------------------------------------------------------

	var el1 = new joint.shapes.html.Element({ 
	    position: { x: 600, y: 250 }, 
	    size: { width: 170, height: 100 },
	    inPorts: ['in'],
	    outPorts: ['out'],
	    textarea: 'Start writing'
	  });

	var el2 = new joint.shapes.html.Element({ 
	    position: { x: 600, y: 400 },
	    size: { width: 170, height: 100 },
	    inPorts: ['in'],
	    outPorts: ['out'],
	    textarea: 'Start writing'
	  });

	graph.addCells([el1, el2]);

    </script>


	<!-- Bootstrap Core JavaScript -->
	<script src="bower_components/bootstrap/dist/js/bootstrap.min.js"></script>

	<!-- Metis Menu Plugin JavaScript -->
	<script src="bower_components/metisMenu/dist/metisMenu.min.js"></script>

	<!-- Morris Charts JavaScript -->
	<script src="bower_components/raphael/raphael-min.js"></script>

	<!-- Custom Theme JavaScript -->
	<script src="dist/js/sb-admin-2.js"></script>
	<script>
		  $(function() {
			
		    $( "#draggable" ).droppable({
		      drop: function( event, ui ) {
		        console.log("dropped");
		      }
		    });
		  });
		</script>

</body>

</html>
